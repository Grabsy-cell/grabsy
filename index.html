<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
  const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRyjqk5-lDiw3arwv281cvWMPyAfp7_uBUXVWlQslsixT-u5fAXSNmV0gkB5-HieWRqYGOI7JFdhsJ8/pub?output=csv";

  async function fetchData() {
    const response = await fetch(sheetURL);
    const csv = await response.text();
    return new Promise((resolve) => {
      Papa.parse(csv, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          resolve(results.data);
        }
      });
    });
  }

  function renderFilters(categories) {
    const filterContainer = document.getElementById("filters");
    filterContainer.innerHTML = "";

    const allBtn = document.createElement("button");
    allBtn.textContent = "All";
    allBtn.classList.add("active");
    allBtn.onclick = () => {
      document.querySelectorAll(".filters button").forEach(btn => btn.classList.remove("active"));
      allBtn.classList.add("active");
      renderProducts(window.allProducts);
    };
    filterContainer.appendChild(allBtn);

    categories.forEach(cat => {
      const btn = document.createElement("button");
      btn.textContent = cat;
      btn.onclick = () => {
        document.querySelectorAll(".filters button").forEach(btn => btn.classList.remove("active"));
        btn.classList.add("active");
        renderProducts(window.allProducts.filter(p => p.Category === cat));
      };
      filterContainer.appendChild(btn);
    });
  }

  function renderProducts(products) {
    const container = document.getElementById("products");
    container.innerHTML = "";

    products.forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <img src="${p["Image URL"]}" alt="${p["Product Name"]}" />
        <h3>${p["Product Name"] || "Untitled"}</h3>
        <p>${p["Description"] || ""}</p>
        <a href="${p["Amazon Link"]}" target="_blank">Buy on Amazon</a>
      `;
      container.appendChild(card);
    });
  }

  (async () => {
    const products = await fetchData();
    window.allProducts = products;
    const categories = [...new Set(products.map(p => p.Category).filter(c => c))];
    renderFilters(categories);
    renderProducts(products);
  })();
</script>
